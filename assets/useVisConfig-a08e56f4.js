import{j as w}from"./jsx-runtime-f14b59b8.js";import{r as i}from"./index-18f6e4ac.js";import{l as k}from"./visConfigSlice-c5711f83.js";import{u as a}from"./store-bae56153.js";const x=async t=>{let o=await fetch(t);return o.json()};const S=async t=>{const o=4.23;let e={...t};if(!t.validated||t.validated<o){if(e.theme&&e.theme.includes("theme-")){e.theme=e.theme.split("-")[1]}if(e.visual){e.componentStyle={accent:e.visual.accent,background:e.visual.background,border:e.visual.border,shadow:e.visual.shadow};if(e.visual.accent)delete e.visual.accent;if(e.visual.background)delete e.visual.background;if(e.visual.border)delete e.visual.border;if(e.visual.shadow)delete e.visual.shadow}e.validated=o}return e};const y=async t=>{let o=t;o=await S(o);return o};const V=i.createContext({});V.displayName="VisualizationConfig";const E=({visualizationKey:t="__default__",config:o,configUrl:e,children:u,defaultConfig:r,transformConfig:d}={})=>{const[c,n]=i.useState(false);const f=a(s=>s.addVisConfig);const g=a(s=>s.updateVisConfig);const C=a(s=>s.visualizations[t]);const l=a(s=>{var p,v;return(v=(p=s.visualizations["__default__"])==null?void 0:p.visualizations)==null?void 0:v[t]});const h=a(s=>s.getData);const _=i.useCallback(()=>{let s=l??C;if(!s){return null}if(d){s=d(s)}return s},[l,C,d]);i.useEffect(()=>{async function s(){const p=l??o??await x(e);const v=k.merge(r,p);const m={...y(v)};if(!l){f(t,m)}else{g(t,m)}await h(t,m);n(false)}if(c||C){return}n(true);void s()},[e,r,c,o,t,C,l,h,f,g]);if(c||!_()){console.log("no stored config!");return null}const b={..._(),visualizationKey:t};return w(V.Provider,{value:b,children:u})};const D=()=>{const{visualizationKey:t,...o}=i.useContext(V);const[,e]=i.useTransition();const u=a(n=>n.updateVisConfig);const r=a(n=>n.updateVisConfigField);const d=i.useCallback(n=>{e(()=>u(t,n))},[u,t]);const c=i.useCallback((n,f,g=true)=>{e(()=>r(t,n,f,g))},[r,t]);return{config:o,updateVisConfig:d,updateVisConfigField:c}};E.__docgenInfo={"description":"","methods":[],"displayName":"VisConfigProvider"};export{E as V,D as u};
//# sourceMappingURL=useVisConfig-a08e56f4.js.map
