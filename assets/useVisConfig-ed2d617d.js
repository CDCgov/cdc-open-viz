import{j as b}from"./jsx-runtime-670450c2.js";import{r as n}from"./index-f1f749bf.js";import{u as i,i as E,l as S}from"./store-4dc22f46.js";const y=async t=>(await fetch(t)).json(),D=async t=>{let e={...t};return(!t.validated||t.validated<4.23)&&(e.theme&&e.theme.includes("theme-")&&(e.theme=e.theme.split("-")[1]),e.visual&&(e.componentStyle={accent:e.visual.accent,background:e.visual.background,border:e.visual.border,shadow:e.visual.shadow},e.visual.accent&&delete e.visual.accent,e.visual.background&&delete e.visual.background,e.visual.border&&delete e.visual.border,e.visual.shadow&&delete e.visual.shadow),e.validated=4.23),e},F=async t=>{let a=t;return a=await D(a),a},h=n.createContext({});h.displayName="VisualizationConfig";const P=({visualizationKey:t="__default__",config:a,configUrl:e,children:f,defaultConfig:r,transformConfig:u}={})=>{const[c,o]=n.useState(!1),g=n.useRef(a),d=n.useRef(!1),m=i(s=>s.addVisConfig),_=i(s=>s.updateVisConfig),C=i(s=>s.visualizations[t]),l=i(s=>{var v,p;return(p=(v=s.visualizations.__default__)==null?void 0:v.visualizations)==null?void 0:p[t]}),w=i(s=>s.getData),k=n.useCallback(()=>{let s=l??C;return s?(u&&(s=u(s)),s):null},[l,C,u]);if(n.useEffect(()=>(E(a,g.current)||(g.current=a,d.current=!0),()=>{}),[a]),n.useEffect(()=>{async function s(){const v=l??a??await y(e),p=S.merge(r,v),V={...await F(p)};l?_(t,V):m(t,V),await w(t,V),d.current=!1,o(!1)}if(!(!d.current&&(c||C)))return o(!0),s(),()=>{}},[a,e,r,c,t,C,l,w,m,_]),c||!k())return null;const x={...k(),visualizationKey:t};return b(h.Provider,{value:x,children:f})},T=()=>{const{visualizationKey:t,...a}=n.useContext(h),[,e]=n.useTransition(),f=i(o=>o.updateVisConfig),r=i(o=>o.updateVisConfigField),u=n.useCallback(o=>{e(()=>f(t,o))},[f,t]),c=n.useCallback((o,g,d=!0)=>{e(()=>r(t,o,g,d))},[r,t]);return{config:a,visualizationKey:t,updateVisConfig:u,updateVisConfigField:c}};P.__docgenInfo={description:"",methods:[],displayName:"VisConfigProvider"};export{P as V,T as u};
//# sourceMappingURL=useVisConfig-ed2d617d.js.map
