import{j as w}from"./jsx-runtime-670450c2.js";import{r as i}from"./index-f1f749bf.js";import{l as k}from"./visConfigSlice-bf7622bc.js";import{u as a}from"./store-0ad8816f.js";const x=async t=>(await fetch(t)).json(),S=async t=>{let e={...t};return(!t.validated||t.validated<4.23)&&(e.theme&&e.theme.includes("theme-")&&(e.theme=e.theme.split("-")[1]),e.visual&&(e.componentStyle={accent:e.visual.accent,background:e.visual.background,border:e.visual.border,shadow:e.visual.shadow},e.visual.accent&&delete e.visual.accent,e.visual.background&&delete e.visual.background,e.visual.border&&delete e.visual.border,e.visual.shadow&&delete e.visual.shadow),e.validated=4.23),e},y=async t=>{let o=t;return o=await S(o),o},V=i.createContext({});V.displayName="VisualizationConfig";const E=({visualizationKey:t="__default__",config:o,configUrl:e,children:u,defaultConfig:r,transformConfig:d}={})=>{const[c,n]=i.useState(!1),f=a(s=>s.addVisConfig),g=a(s=>s.updateVisConfig),C=a(s=>s.visualizations[t]),l=a(s=>{var v,p;return(p=(v=s.visualizations.__default__)==null?void 0:v.visualizations)==null?void 0:p[t]}),h=a(s=>s.getData),_=i.useCallback(()=>{let s=l??C;return s?(d&&(s=d(s)),s):null},[l,C,d]);if(i.useEffect(()=>{async function s(){const v=l??o??await x(e),p=k.merge(r,v),m={...y(p)};l?g(t,m):f(t,m),await h(t,m),n(!1)}c||C||(n(!0),s())},[e,r,c,o,t,C,l,h,f,g]),c||!_())return console.log("no stored config!"),null;const b={..._(),visualizationKey:t};return w(V.Provider,{value:b,children:u})},D=()=>{const{visualizationKey:t,...o}=i.useContext(V),[,e]=i.useTransition(),u=a(n=>n.updateVisConfig),r=a(n=>n.updateVisConfigField),d=i.useCallback(n=>{e(()=>u(t,n))},[u,t]),c=i.useCallback((n,f,g=!0)=>{e(()=>r(t,n,f,g))},[r,t]);return{config:o,updateVisConfig:d,updateVisConfigField:c}};E.__docgenInfo={description:"",methods:[],displayName:"VisConfigProvider"};export{E as V,D as u};
//# sourceMappingURL=useVisConfig-4fe3448c.js.map
