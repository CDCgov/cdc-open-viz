import { Canvas, Meta, Story, ArgsTable } from '@storybook/blocks';

import { useConfigStore } from '../../../stores/configStore'

import ConfigProxy from '../ConfigProxy'

<Meta
  title="Components/HOC/ConfigProxy"
  component={ConfigProxy}
/>

# ConfigProxy Component
The ConfigProxy acts as a configuration settings and data proxy for children COVE components.

<Canvas sourceState="hidden">
  <Story name="Example"
         args={{
           configObj: {
             theme: 'blue',
             title: 'Example Title',
             description: 'This is an example of config settings being pulled in to the configStore, and being provided to the children'
           }
         }}>
    {Template.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Example"/>

<br/>
<br/>
## Detailed Usage
The flow of the ConfigProxy process performs the following steps:
1. The ConfigProxy is provided several configuration settings: `configObj`, `configUrl`, `defaults`, `runtime` <br/> *(see table above for specifics on each)*
2. Using the provided sources, the supplied configuration settings are then procedurally resolved into a consolidated, uniform format.
3. The final generated configuration is then sent up to the `configStore` and stored as `config`.
4. Once the `config` has been populated, a flag is triggered which allows all content between the `<ConfigProxy/>` tags (its children) to be rendered. This ensures that any required configuration data is available when content is rendered.
5. The `config` settings in the `configStore` are then consumed by COVE visualizations or subcomponents, and render their expected displays.

<br/>
### Example

Using the following JSON configuration can be assigned to ConfigProxy's `configObj` property value:
```jsx
const exampleJson = {
  theme: 'blue',
  title: 'Example Title',
  description: 'This is an example of config settings being pulled in to the configStore, and being provided to the children'
}

...

<ConfigProxy configObj={...exampleJson}>
  ...
</ConfigProxy>
```
The `config` value of the `configStore` can then be accessed, and used to reference the config options that were previously defined in the JSON.
```jsx
const { config } = useConfigStore()
return (
  <ConfigProxy configObj={...exampleJson}>
    <div className="example-wrapper">
      <h2>{config.title}</h2>
      <p>{config.description}</p>
      <br/>
      <strong>Theme:</strong> {config.theme}
    </div>
  </ConfigProxy>
)
```

export const Template = ({ ...args }) => {
  const { config } = useConfigStore()
  return (
    <ConfigProxy {...args}>
      <div className="example-wrapper">
        <h2>{config.title}</h2>
        <p>{config.description}</p>
        <br/>
        <strong>Theme:</strong> {config.theme}
      </div>
    </ConfigProxy>
  )
}
